-cloudindex = 0
= f.fields_for :meteorology do |m|
  .row
    .span4
      .control-group
        = m.label :visibility_lookup_id, "Visibility", class: 'control-label'
        .controls
          = m.collection_select :visibility_lookup_id, VisibilityLookup.all, :id, :code_with_name, |
            { :include_blank => true }, { :class => :combobox }
          %p.help-block
            m-km
    .span4
      .control-group
        = m.label :weather_lookup_id, "Weather", class: 'control-label'
        .controls
          = m.collection_select :weather_lookup_id, WeatherLookup.all, :id, :code_with_name, |
            { :include_blank => true }, { :class => :combobox }
          %p.help-block
  .row
    = render :partial => 'clouds', locals: {f: m, cloud: @observation.meteorology.clouds.high, index: (cloudindex += 1), title: 'High'}
    = render :partial => 'clouds', locals: {f: m, cloud: @observation.meteorology.clouds.medium, index: (cloudindex += 1), title: 'Medium'}
    = render :partial => 'clouds', locals: {f: m, cloud: @observation.meteorology.clouds.low, index: (cloudindex += 1), title: 'Low'}