function handleTopographies( ) {
  var raftCodes = <%= TopographyLookup.where("code >= 400 AND code < 500").pluck(:id) %>;
  var ridgeCodes = <%= TopographyLookup.where("code >= 500 AND code < 600").pluck(:id) %>;
  var rafts = false;
  var ridges = false;

  $(".topography option:selected").each( function(index, item) {
    var value = parseInt($(item).val());
    var group = $(this).parents(".topography_group");
    if(raftCodes.indexOf(value) >= 0) {
      rafts = true;
      //Disable non-rafts
      var inputs = $(group).find(".ridges:not(.rafts) input");
      $(group).find(".ridges:not(.rafts) select").select2("disable");
      $(group).find(".rafts select").select2("enable");
      $(inputs).val('');
      $(inputs).removeAttr("selected");
      $(inputs).removeAttr("checked")
      $(inputs).attr("disabled", true);
      $(group).find('.btn').removeClass('active').attr('disabled',true);
      //Enable rafts
      $(group).find(".rafts").removeAttr("disabled");
    } else if(ridgeCodes.indexOf(value) >= 0) {
      ridges = true;
      $(group).find(".ridges input").removeAttr("disabled");
      $(group).find(".rafts:not(.ridges) select").select2('disable')
      $(group).find('.btn').removeAttr('disabled');
      $(group).find(".ridges select").select2("enable");
    } else {
      var inputs = $(group).find(".ridges input");
      $(group).find(".ridges select").select2("disable");
      $(inputs).val('');
      $(inputs).removeAttr("selected");
      $(inputs).removeAttr("checked");
      $(inputs).attr("disabled", true);
      $(group).find('.btn').removeClass('active').attr('disabled',true);

      $(".ridges option").removeAttr("selected");
      $(group).find(".ridges").val('');
      $(group).find('.concentration').trigger('change');
    }
  
  });
  
    if(ridges) {
    $(".ridges").removeClass("hide");
    $(".rafts:not(.ridges)").addClass('hide');  
  } else if(rafts) { 
    $(".rafts").removeClass("hide")
    $(".ridges:not(.rafts)").addClass("hide");
  } else {
    $(".ridges").addClass("hide");
    $(".rafts").addClass("hide")
  }

}

$(document).ready( function() {
  handleTopographies();
  $(".topography").on("change", handleTopographies);
});